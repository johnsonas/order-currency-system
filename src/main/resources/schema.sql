-- Oracle 資料庫 Schema 建立腳本

-- 建立幣別表
CREATE TABLE CURRENCIES (
    CURRENCY_CODE VARCHAR2(3) PRIMARY KEY,
    RATE_TO_TWD NUMBER(19, 6) NOT NULL,
    LAST_UPDATE TIMESTAMP
);

-- 建立訂單表
CREATE TABLE ORDERS (
    ORDER_ID NUMBER PRIMARY KEY,
    USERNAME VARCHAR2(50) NOT NULL,
    AMOUNT NUMBER(19, 2) NOT NULL,
    CURRENCY VARCHAR2(3) NOT NULL,
    STATUS VARCHAR2(20) DEFAULT 'PENDING',
    DISCOUNT NUMBER(5, 2) DEFAULT 0,
    FINAL_AMOUNT NUMBER(19, 2),
    CREATED_AT TIMESTAMP,
    UPDATED_AT TIMESTAMP
);

-- 建立訂單序號
CREATE SEQUENCE ORDER_SEQ
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

-- 建立索引
CREATE INDEX IDX_ORDERS_USERNAME ON ORDERS(USERNAME);
CREATE INDEX IDX_ORDERS_STATUS ON ORDERS(STATUS);
CREATE INDEX IDX_ORDERS_CURRENCY ON ORDERS(CURRENCY);

-- 建立 CREATED_AT 索引（用於排序，提升查詢效能）
CREATE INDEX IDX_ORDERS_CREATED_AT ON ORDERS(CREATED_AT DESC);

-- 建立函數索引（用於 ORDER_ID 字串搜尋，大幅提升 LIKE 查詢效能）
-- 這個索引會將 ORDER_ID 轉換為字串後建立索引，讓 LIKE '%...%' 查詢可以使用索引
CREATE INDEX IDX_ORDERS_ORDER_ID_STR ON ORDERS(TO_CHAR(ORDER_ID));

